# 当一个程序crash之后该如何定位

下面是avs_mrm 测试时，一个crash的现象

```
[  386.211967@2]  SampleApp[4768]: unhandled exception: 11 DABT (lower EL), ESR 0x92000007, level 3 translation fault in libcrypto.so.1.1[f5fd7000+1c6000]
[  386.213110@2]  vma for f613c894:
[  386.213458@2]  f5fd7000-f619d000 r-xp 00000000 b3:08 1063 
[  386.213466@2]  /usr/lib/libcrypto.so.1.1
[  386.214158@2]  
[  386.214842@2]  vma for f613d3c8:
[  386.215245@2]  f5fd7000-f619d000 r-xp 00000000 b3:08 1063 
[  386.215274@2]  /usr/lib/libcrypto.so.1.1
[  386.215923@2]  
[  386.216663@2]  vma for 48:
[  386.216979@2]  00010000-00017000 r-xp 00000000 b3:08 513 
[  386.216998@2]  /usr/bin/SampleApp
[  386.217632@2]  
[  386.218250@2]  PC : 00000000f613c894  U
[  386.218738@2]  SP : 00000000c15cc5c0  U
[  386.219214@2]  FAR : 0000000000000048  U
[  386.219708@2]  CPU: 2 PID: 4768 Comm: SampleApp Tainted: G           O      5.4.180-06417-g1c44d21f59b1-dirty #2
[  386.221008@2]  Hardware name: Amlogic (DT)
[  386.221482@2]  pstate: 20830010 (nzCv q A32 LE aif)
[  386.222087@2]  pc : 00000000f613c894
[  386.222529@2]  lr : 00000000f613d3c8
[  386.222974@2]  sp : 00000000c15cc5c0
```

## 计算crash地址

f613c894-f5fd7000 = 16 5894

## 使用命令查看crash库在上述地址处的函数是什么

```
 arm-linux-gnueabihf-readelf -a 库的路径
```

这条命令解析的库必须是当前使用的库，要不然没有意义。

如果找不到16 5894地址，则就找与16 5894最接近的

## 根据地址定位crash

出现问题的日志

```
[16:08:17:483]khm -- epollEventHandlerWork[  186.199544@1]  SampleApp[2277]: unhandled exception: 11 IABT (lower EL), ESR 0x8200000f, level 3 permission fault in ld-2.33.so[f7cf4000+1000]
[16:08:17:484][  186.201154@1]  vma for f7cf4a10:
[16:08:17:484][  186.201512@1]  f7cf4000-f7cf5000 rw-p 0001d000 b3:08 290 
[16:08:17:484][  186.201517@1]  /lib/ld-2.33.so
[16:08:17:484][  186.202183@1]  
[16:08:17:484][  186.202782@1]  vma for f6a847b0:
[16:08:17:485][  186.203181@1]  f6a81000-f6a86000 r-xp 00000000 b3:08 917 
[16:08:17:489][  186.203187@1]  /usr/lib/libSERVER.so
[16:08:17:489][  186.203873@1]  
[16:08:17:489][  186.204512@1]  vma for f7cf4a10:
[16:08:17:489][  186.204915@1]  f7cf4000-f7cf5000 rw-p 0001d000 b3:08 290 
[16:08:17:490][  186.204921@1]  /lib/ld-2.33.so
[16:08:17:490][  186.205620@1]  
[16:08:17:490][  186.206182@1]  PC : 00000000f7cf4a10  U
[16:08:17:490][  186.206657@1]  SP : 00000000e7782c48  U
[16:08:17:490][  186.207134@1]  FAR : 00000000f7cf4a10  U
[16:08:17:490][  186.207626@1]  CPU: 1 PID: 2277 Comm: SampleApp Tainted: G           O      5.4.210-08097-g02f5f9a07535 #2
[16:08:17:490][  186.208824@1]  Hardware name: a5_a113x2_av400_1g (DT)
[16:08:17:496][  186.209486@1]  pstate: a08f0010 (NzCv q A32 LE aif)
[16:08:17:496][  186.210059@1]  pc : 00000000f7cf4a10
[16:08:17:496][  186.210502@1]  lr : 00000000f6a847b0
[16:08:17:496][  186.210947@1]  sp : 00000000e7782c48
[16:08:17:496][  186.211391@1]  x12: 0000000000000004 
[16:08:17:496][  186.211885@1]  x11: 00000000f3c04c08 x10: 00000000f3c04c08 
[16:08:17:496][  186.212590@1]  x9 : 00000000f6a84c36 x8 : 00000000f6a84e4c 
[16:08:17:496][  186.213283@1]  x7 : 00000000f6a96188 x6 : 0000000000000008 
[16:08:17:496][  186.213953@1]  x5 : 00000000e7782c98 x4 : 00000000f6a96000 
[16:08:17:497][  186.214635@1]  x3 : 00000000f7cf4a10 x2 : 00000000e77833b0 
[16:08:17:499][  186.215323@1]  x1 : 0000000000000000 x0 : 0000000000000004 
[16:08:17:500][  186.216018@1]  
[16:08:17:500][  186.216018@1]  PC: 0xf7cf4990:
[16:08:17:501][  186.216614@1]  4990  00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
[16:08:17:501][  186.217720@1]  49b0  00000000 00000000 ffffffff 00000000 00000000 00000000 00000000 f589b000
[16:08:17:501][  186.218715@1]  49d0  f5899fd0 f5898000 00000000 00000000 00000000 00000000 f7cf4d08 00000000
[16:08:17:502][  186.219762@1]  49f0  01a88000 00000000 00000000 00000000 00000000 00000000 ff82dfbc 00000000
```

用以下命令定位。

```
arm-linux-gnueabihf-objdump -dS ./output/a5_av400_a6432_release/build/avs-sdk/Server/libSERVER.so > 1.asm

python3

>>> 0xf6a847b0-0xf6a81000
14256
>>> hex(14256)
'0x37b0'
>>> 
```

打开 1.asm 文件，搜索37b0,即为发生错误的地方